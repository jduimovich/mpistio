<!DOCTYPE html>
<html>

<body onload="loaded()">

	<h2> Sample Istio In Liberty</h2>

	<h3> Route
	<label id="toptext"> ... </label>
    </h3>

	<table style="width:100%" border=1>
		<tr>
			<th width="15%"> Action </th>
			<th width="15%"> Filter </th> 
			<th width="55%"> Result </th>
			<th width="15%"> Stats </th>
		</tr>
		<tr>
			<td width="15%">
                <button type="button"  onclick="v1get()"> Call /get </button>
            </td>
			<td width="15%">
				<textarea id="v1getfilter" rows="2" cols="10"> </textarea>
			</td>
			<td  width="55%">
				<p><div id="v1get"> (will hold results of last call)</div> </p>
			</td>
			<td width="15%">
				<p> <div id="v1getcount"> </div> </p>
			</td>

		</tr>
        <tr>
		    <td width="15%"> <button type="button"  onclick="v1all()"> Call /all</button></td>
			<td width="15%">  <textarea id="v1allfilter" rows="2" cols="10"> </textarea> </td>
			<td  width="55%"> <p> <div id="v1all"> (will hold results of last call) </div> </p> </td>
            <td width="15%"> <p> <div id="v1allcount"> </div> </p> </td>
		</tr>

	</table>


	<script>
        function fetchJSONThen(url, filter, callback) {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
                    callback (this.responseText);  
				}
			}; 
			xhttp.open("GET", url, true);
			xhttp.setRequestHeader('Content-type', 'application/json');
			xhttp.setRequestHeader('Accept', 'application/json');
			xhttp.setRequestHeader('Filter', filter);
			xhttp.send();
		}

		function LUI(url, destElement, filter) {
            fetchJSONThen (url, filter, function (json) {
					document.getElementById(destElement).innerHTML = json;
                    });  
        }
        function getFilter (id)  { 
           return document.getElementById(id).value.trim(); 
        }
        var byVersion = {};
		function v1get() { 
            fetchJSONThen ("/get", getFilter("v1getfilter"), function (json) {
					document.getElementById("v1get").innerHTML = json;
                    var r = JSON.parse (json);
                    if (byVersion[r.version] == undefined) byVersion[r.version]= 0;
                    byVersion[r.version] = byVersion[r.version]+1;
					document.getElementById("v1getcount").innerHTML = JSON.stringify (byVersion);
                    
            });  
		}
        function v1all() { 
             fetchJSONThen ("/all", getFilter("v1allfilter"), function (json) {
					document.getElementById("v1all").innerHTML = '<pre> ' + json  + '</pre>';
                    });  
		} 
        function loaded () { 
            document.getElementById("toptext").innerText = window.location.href;
        }
	</script>

</body>

</html>